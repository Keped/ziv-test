<html>
    <head>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@1,100&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./style/general.css">
    </head>
    <body class="elementor-test">
       <h1 id="pageTitle"></h1>
       <div class="user-details">
            <h5 id="detailsNotFoundTitle">
                You are offline
            </h5>
            <h5 id="detailsFoundArea">
                <span id="detailsFoundTitle"></span>
                <br/>
                <a href="#" onClick="logOut()">Disconnect</a>
            </h5>

       </div> 
       <div id="pageContainer"></div>
       <script type="text/javascript" src="./scripts/constants.js" ></script>
       <script type="text/javascript" src="./scripts/services/api.js" /></script>
       <script type="text/javascript" src="./scripts/services/store.js" /></script>
       <script type="text/javascript" src="./scripts/services/gui.js" /></script>
       <script type="text/javascript" src="./scripts/controllers/auth.js" /></script>
       <script type="text/javascript">
        function domReady(fn) {
            // If we're early to the party
            document.addEventListener("DOMContentLoaded", fn);
            // If late; I mean on time.
            if (document.readyState === "interactive" || document.readyState === "complete" ) {
                fn();
            }
        }
        const serialize = function(obj){
            return JSON.stringify(obj, Object.keys(obj).sort());
        }
        const compareLists = function(a,b){
            if(a && b){
                return serialize(a) === serialize(b);
            }
            return false; 
        }
       var templateName = "loginTemplate";
        let needChange = true;
        domReady(()=>{
            checkAuthStatus().then((res)=>{
                    // setMainTitle(res)

                })
            setCurrentTemplate(templateName)
            setInterval(function(){
                // console.log(appState)
                
                const token = StorageService.get(TAB_SESSION_TOKEN);
                const lastResultMap = StorageService.get(LIST_MAP_TOKEN);
                if(token && token !== 'null'){
                    console.log(token + " !!!!!!!!!!!")
                    ApiService.getList(token).then((res)=>{
                  
                        needChange = false;
                        let newMap = {};
                        res.list.map((loginData)=>{
                            // if(typeof(lastResultMap[loginData._id]) == 'undefined'){
                            //     needChange = true;
                            // }
                            newMap[loginData._id] = loginData;
                        });
                        StorageService.set(LIST_MAP_TOKEN,JSON.stringify(newMap));
                        if (compareLists(newMap,JSON.parse(lastResultMap))) { 
                            setCurrentTemplate("listTemplate", res.list);
                        }
                            
                    });
                } 
            },30*100)
            
            // logIn('models1','adminadmin2').then((res)=>{
            //     res && console.log(res)
            // }).catch((e)=>{
            //     // setMainTitle(e)
            // })
        })
       </script>
    </body>    
</html>